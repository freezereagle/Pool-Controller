/* Compact Pool Controller Dashboard */
:root {
    --primary: #0ea5e9;
    --primary-dark: #0284c7;
    --success: #22c55e;
    --danger: #ef4444;
    --warning: #f59e0b;
    --bg: #f0f4f8;
    --card: #fff;
    --card-alt: #f8fafc;
    --text: #1e293b;
    --text2: #64748b;
    --text3: #94a3b8;
    --border: #e2e8f0;
    --radius: 4px;
}
.dark-mode {
    --bg: #0f172a;
    --card: #1e293b;
    --card-alt: #334155;
    --text: #f1f5f9;
    --text2: #94a3b8;
    --text3: #64748b;
    --border: #334155;
    color-scheme: dark;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html, body { height: 100%; overflow: hidden; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 12px; background: var(--bg); color: var(--text); }
.hidden { display: none !important; }

/* Header */
.header { height: 32px; background: var(--card); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 8px; }
.header-left, .header-right { display: flex; align-items: center; gap: 8px; }
.header-left i { color: var(--primary); font-size: 16px; }
.header-left span { font-weight: 600; font-size: 13px; }
.build-info { font-size: 9px; color: var(--text3); }
.icon-btn { background: none; border: none; color: var(--text2); cursor: pointer; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: var(--radius); }
.icon-btn:hover { background: var(--card-alt); color: var(--primary); }
.icon-btn.sm { width: 20px; height: 20px; }
.icon-btn.sm i { font-size: 14px; }
.conn-badge { display: flex; align-items: center; gap: 4px; padding: 2px 8px; border-radius: 10px; font-size: 10px; font-weight: 600; cursor: pointer; }
.conn-badge.offline { background: rgba(239,68,68,0.15); color: var(--danger); }
.conn-badge.online { background: rgba(34,197,94,0.15); color: var(--success); }

/* Settings Overlay */
.settings-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 100; display: flex; justify-content: flex-end; }
.settings-panel { width: 280px; background: var(--card); height: 100%; display: flex; flex-direction: column; }
.settings-head { display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; border-bottom: 1px solid var(--border); font-weight: 600; }
.settings-head i { color: var(--primary); margin-right: 4px; }
.settings-body { padding: 12px; overflow-y: auto; flex: 1; }
.form-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
.form-row label { font-size: 11px; color: var(--text2); }
.form-row input, .form-row select { padding: 4px 8px; border: 1px solid var(--border); border-radius: var(--radius); font-size: 11px; background: var(--card-alt); color: var(--text); width: 140px; }
.settings-btns { display: flex; gap: 8px; margin: 12px 0; }
.settings-btns .btn { flex: 1; }
.settings-section { border-top: 1px solid var(--border); padding-top: 10px; margin-top: 10px; }
.info-line { display: flex; justify-content: space-between; font-size: 10px; padding: 2px 0; }
.info-line span:first-child { color: var(--text2); }

/* Toggle Switch */
.toggle { position: relative; width: 32px; height: 16px; display: inline-block; }
.toggle input { opacity: 0; width: 0; height: 0; }
.tog-slider { position: absolute; inset: 0; background: var(--border); border-radius: 16px; cursor: pointer; transition: 0.2s; }
.tog-slider::before { content: ''; position: absolute; width: 12px; height: 12px; left: 2px; top: 2px; background: #fff; border-radius: 50%; transition: 0.2s; }
.toggle input:checked + .tog-slider { background: var(--success); }
.toggle input:checked + .tog-slider::before { transform: translateX(16px); }

/* Buttons */
.btn { padding: 4px 12px; border: 1px solid var(--border); border-radius: var(--radius); font-size: 11px; font-weight: 500; cursor: pointer; background: var(--card-alt); color: var(--text); transition: 0.15s; }
.btn:hover { border-color: var(--primary); }
.btn:disabled { opacity: 0.5; cursor: not-allowed; }
.btn.primary { background: var(--primary); color: #fff; border-color: var(--primary); }
.btn.primary:hover { background: var(--primary-dark); }
.btn.danger { background: var(--danger); color: #fff; border-color: var(--danger); width: 100%; }
.btn.danger:hover { opacity: 0.9; }
.btn.sm { padding: 2px 8px; font-size: 10px; }

/* Offline State */
.offline-state { display: flex; flex-direction: column; align-items: center; justify-content: center; height: calc(100vh - 32px); gap: 12px; color: var(--text2); }
.offline-state i { font-size: 48px; color: var(--primary); opacity: 0.4; }

/* Dashboard */
.dashboard { height: calc(100vh - 32px); padding: 6px; overflow: hidden; display: flex; flex-direction: column; gap: 6px; }

/* Alert Banner */
.alarm-banner { display: flex; align-items: center; gap: 8px; background: rgba(239,68,68,0.15); border: 1px solid var(--danger); border-radius: var(--radius); padding: 4px 10px; font-size: 11px; color: var(--danger); }
.alarm-banner i { font-size: 14px; }
.alarm-banner button { background: none; border: none; color: var(--danger); cursor: pointer; margin-left: auto; }

/* Stats Row */
.stats-row { display: flex; gap: 6px; }
.stat { flex: 1; display: flex; align-items: center; gap: 6px; padding: 6px 10px; background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); }
.stat i { font-size: 18px; }
.stat.water i { color: #0ea5e9; }
.stat.air i { color: #f59e0b; }
.stat.pump i { color: #8b5cf6; }
.stat.power i { color: #f43f5e; }
.stat.flow i { color: #06b6d4; }
.stat.salt i { color: #22c55e; }
.stat.chlor-temp i { color: #14b8a6; }
.stat.chlor-temp i { color: #14b8a6; }
.stat span { font-size: 16px; font-weight: 700; }
.stat small { font-size: 12px; color: var(--text2); margin-left: 3px; }
.stat.pump.running { animation: pulse 1.5s infinite; }
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.6} }

/* Quick Controls */
.quick-row { display: flex; gap: 6px; }
.qc-btn { flex: 1; display: flex; align-items: center; justify-content: center; gap: 6px; padding: 6px; background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); cursor: pointer; font-size: 11px; font-weight: 500; color: var(--text2); transition: 0.15s; }
.qc-btn i { font-size: 16px; }
.qc-btn:hover { border-color: var(--primary); color: var(--primary); }
.qc-btn.active { border-color: var(--success); background: rgba(34,197,94,0.1); color: var(--success); }
.qc-st { font-size: 9px; padding: 1px 6px; border-radius: 8px; background: var(--card-alt); }
.qc-btn.active .qc-st { background: var(--success); color: #fff; }

/* Grid */
.grid { flex: 1; display: grid; grid-template-columns: repeat(12, 1fr); grid-auto-rows: min-content; gap: 6px; min-height: 0; align-content: start; }
.card { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); display: flex; flex-direction: column; grid-column: span 3; }
.card.single { grid-column: span 2; }
.card.wide { grid-column: span 6; }
.card.third { grid-column: span 4; }
.card.narrow { grid-column: span 2; }
/* Vertical Card Stack - groups cards in same grid position */
.card-stack { display: flex; flex-direction: column; gap: 6px; grid-column: span 2; }
.card-stack.wide { grid-column: span 6; }
.card-stack.third { grid-column: span 4; }
.card-stack.default { grid-column: span 3; }
.card-stack .card { grid-column: unset; width: 100%; }
.card-head { display: flex; align-items: center; justify-content: space-between; padding: 4px 8px; background: var(--card-alt); border-bottom: 1px solid var(--border); font-size: 11px; font-weight: 600; gap: 6px; }
.card-head i { color: var(--primary); margin-right: 4px; }
.card-width-btn { background: none; border: none; color: var(--text3); cursor: pointer; padding: 2px 4px; font-size: 12px; opacity: 0.5; transition: opacity 0.15s; margin-left: auto; }
.card-width-btn:hover { opacity: 1; color: var(--primary); }
.card-head .drag-handle { margin-left: 0; margin-right: 0; color: var(--text3); cursor: grab; opacity: 0.5; transition: opacity 0.15s; }
.card-head:hover .drag-handle { opacity: 1; }
.card.dragging { opacity: 0.5; transform: scale(0.98); }
.card.drag-over { outline: 2px dashed var(--primary); outline-offset: 2px; }
.card-grid { padding: 6px; display: grid; gap: 4px; }
.card-grid.cols2 { grid-template-columns: 1fr 1fr; }
/* Responsive internal columns based on card width */
.card.single .card-grid.cols2 { grid-template-columns: 1fr; }
.card.narrow .card-grid.cols2 { grid-template-columns: 1fr; }
.card.wide .card-grid.cols2 { grid-template-columns: 1fr 1fr 1fr; }
.kv { display: flex; justify-content: space-between; font-size: 15px; padding: 2px 4px; background: var(--card-alt); border-radius: 2px; }
.kv span:first-child { color: var(--text2); }
.pill { padding: 1px 6px; border-radius: 8px; font-size: 9px; font-weight: 600; }
.pill.on { background: rgba(34,197,94,0.15); color: var(--success); }
.pill.off { background: var(--card-alt); color: var(--text3); }

/* Mode */
.mode-row { padding: 6px; display: flex; align-items: center; gap: 8px; }
.mode-val { font-size: 24px; font-weight: 700; color: var(--primary); flex: 1; }
.sel { padding: 4px 6px; border: 1px solid var(--border); border-radius: var(--radius); font-size: 10px; background: var(--card-alt); color: var(--text); }

/* Light */
.light-row { padding: 6px; display: flex; align-items: center; gap: 6px; }
.mode-badge { font-size: 15px; padding: 2px 8px; background: var(--primary); color: #fff; border-radius: 8px; }
.tog-btn { padding: 4px 12px; border: 1px solid var(--border); border-radius: var(--radius); font-size: 10px; font-weight: 600; cursor: pointer; transition: 0.15s; }
.tog-btn.off { background: var(--card-alt); color: var(--text3); }
.tog-btn.on { background: var(--success); color: #fff; border-color: var(--success); }

/* Switches */
.switch-grid { padding: 6px; display: grid; grid-template-columns: 1fr 1fr; gap: 4px; }
.sw { display: flex; justify-content: space-between; align-items: center; font-size: 15px; padding: 3px 6px; background: var(--card-alt); border-radius: 2px; }

/* Chlorinator */
.chlor-ctrl-row { padding: 6px; display: flex; align-items: center; gap: 6px; }
.chlor-ctrl-row input[type=range] { flex: 1; height: 4px; }
.sl-val { font-size: 16px; font-weight: 600; color: var(--primary); min-width: 32px; }
.sw-row { padding: 4px 6px; display: flex; justify-content: space-between; align-items: center; font-size: 15px; background: var(--card-alt); border-top: 1px solid var(--border); }

/* Alarms */
.alarm-grid { padding: 6px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 3px; }
.alm { display: flex; align-items: center; gap: 3px; font-size: 13px; padding: 3px 5px; background: var(--card-alt); border-radius: 2px; color: var(--text2); white-space: nowrap; overflow: hidden; }
.alm i { font-size: 16px; color: var(--success); flex-shrink: 0; }
.alm.active { background: rgba(239,68,68,0.15); color: var(--danger); }
.alm.active i { color: var(--danger); }

/* Schedule Table */
.sched-tbl { width: 100%; border-collapse: collapse; font-size: 15px; }
.sched-tbl th, .sched-tbl td { padding: 3px 6px; text-align: center; border-bottom: 1px solid var(--border); }
.sched-tbl thead th { background: var(--card-alt); font-weight: 600; color: var(--text2); font-size: 13px; }
.sched-tbl tbody tr:nth-child(even) { background: var(--card-alt); }
.sched-tbl tfoot td { background: var(--card-alt); }
.foot-lbl { text-align: left !important; font-size: 13px; color: var(--text3); }
.ed { cursor: pointer; }
.ed:hover { background: rgba(14,165,233,0.1) !important; color: var(--primary); }
.wf-badge { padding: 1px 6px; border-radius: 6px; font-size: 13px; font-weight: 600; }
.wf-badge.on { background: rgba(34,197,94,0.15); color: var(--success); }
.wf-badge.off { color: var(--text3); }

/* Speeds */
.speed-row { padding: 8px; display: flex; gap: 8px; justify-content: space-around; flex-wrap: wrap; }
.spd { display: flex; flex-direction: column; align-items: center; gap: 4px; }
.spd label { font-size: 15px; font-weight: 600; color: var(--primary); }
.spd-inp { display: flex; }
.spd-inp button { width: 22px; height: 24px; border: 1px solid var(--border); background: var(--card-alt); cursor: pointer; font-size: 12px; }
.spd-inp button:first-child { border-radius: var(--radius) 0 0 var(--radius); }
.spd-inp button:last-child { border-radius: 0 var(--radius) var(--radius) 0; }
.spd-inp button:hover { background: var(--primary); color: #fff; }
.spd-inp input { width: 50px; height: 24px; border: 1px solid var(--border); border-left: none; border-right: none; text-align: center; font-size: 16px; background: var(--card); color: var(--text); }

/* Modal */
.modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 200; display: flex; align-items: center; justify-content: center; }
.modal-box { background: var(--card); border-radius: var(--radius); padding: 12px; min-width: 200px; }
.modal-head { display: flex; justify-content: space-between; align-items: center; font-weight: 600; margin-bottom: 10px; }
.modal-head button { background: none; border: none; cursor: pointer; color: var(--text2); }
.modal-box input, .modal-box select { width: 100%; padding: 6px; margin-bottom: 10px; border: 1px solid var(--border); border-radius: var(--radius); background: var(--card-alt); color: var(--text); }
.modal-btns { display: flex; gap: 8px; justify-content: flex-end; }

/* Toast */
.toast-container { position: fixed; bottom: 8px; right: 8px; z-index: 300; display: flex; flex-direction: column; gap: 4px; }
.toast { display: flex; align-items: center; gap: 8px; padding: 6px 12px; background: var(--card); border-radius: var(--radius); box-shadow: 0 2px 8px rgba(0,0,0,0.15); font-size: 11px; border-left: 3px solid var(--primary); animation: slideIn 0.2s; }
@keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
.toast.success { border-left-color: var(--success); }
.toast.error { border-left-color: var(--danger); }
.toast.warning { border-left-color: var(--warning); }
.toast.hiding { animation: slideOut 0.15s forwards; }
@keyframes slideOut { to { transform: translateX(100%); opacity: 0; } }
.toast-close { background: none; border: none; cursor: pointer; color: var(--text3); font-size: 14px; }

/* Responsive - Tablet */
@media (max-width: 1024px) {
    .grid { grid-template-columns: repeat(6, 1fr); }
    .card { grid-column: span 3; }
    .card.wide { grid-column: span 3; }
    .card.third { grid-column: span 3; }
    .card.narrow { grid-column: span 2; }
}
/* Responsive - Mobile */
@media (max-width: 640px) {
    html, body { overflow: auto; }
    .dashboard { overflow-y: auto; height: auto; min-height: calc(100vh - 32px); }
    .grid { grid-template-columns: 1fr; }
    .card, .card.wide, .card.third, .card.narrow, .card.single { grid-column: span 1; }
    .card-stack, .card-stack.wide, .card-stack.third, .card-stack.default { grid-column: span 1; }
    .stats-row { flex-wrap: wrap; }
    .stat { flex: 1 1 30%; }
    .quick-row { flex-wrap: wrap; }
    .qc-btn { flex: 1 1 45%; }
    .alarm-grid { grid-template-columns: repeat(2, 1fr); }
    .speed-row { flex-wrap: wrap; }
    .spd { flex: 1 1 30%; min-width: 80px; }
}
